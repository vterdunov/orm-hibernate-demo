# ORM Hibernate (demo) — учебная система управления курсами


## Единый формат ошибок API

Все контроллеры возвращают структурированный ответ `ApiError`:

```json
{
  "timestamp": "2025-05-10T19:33:06.321Z",
  "status": 400,
  "error": "Bad Request",
  "message": "Validation failed",
  "path": "/api/courses",
  "validationErrors": {
    "title": "must not be blank"
  }
}
```

Это позволяет клиентам детерминированно обрабатывать бизнес-ошибки (`AppException`), валидацию и неожиданные сбои.

## Демонстрационные данные

Приложение автоматически наполняет PostgreSQL минимальным набором сущностей (`src/main/resources/data.sql`), поэтому система сразу готова к проверке:

| Сущность | ID | Описание |
| --- | --- | --- |
| Преподаватель | `00000000-0000-0000-0000-000000000001` | Maria Ivanova |
| Студент | `00000000-0000-0000-0000-000000000002` | Alex Petrov (studentNo `STU-001`) |
| Курс | `00000000-0000-0000-0000-000000000010` | `ORM-DEMO / ORM Fundamentals` |
| Тег | `00000000-0000-0000-0000-000000000020` | `Spring` |

Студент уже записан на курс, поэтому сразу можно тестировать уроки, задания и викторины.

## Автоматизация

- GitHub Actions workflow (`.github/workflows/ci.yml`) запускает `mvn -B verify` на каждый push/PR, гарантируя успешный прогон юнит- и интеграционных тестов (Testcontainers PostgreSQL).
- Для локального запуска и разработки: `docker compose up -d postgres`
- Запуск тестов (Testcontainers) `mvn clean verify`.

## Docker-образ

1. Соберите и запустите весь стек через Docker Compose (образ соберётся автоматически):
   ```bash
   docker compose up -d --build app
   ```
   Compose поднимет PostgreSQL `postgres:18.1` и приложение, а сеть/переменные окружения уже настроены на совместную работу.
2. Отслеживайте логи приложения:
   ```bash
   docker compose logs -f app
   ```
3. Остановите и удалите контейнеры (плюс volume с данными Postgres):
   ```bash
   docker compose down -v
   ```
   После старта API доступно на `http://localhost:8080`.

## Переменные окружения

Приложение читает параметры подключения к БД и профиль из переменных окружения (для Docker их можно задавать через `environment`):

| Переменная | Назначение | Значение по умолчанию |
| --- | --- | --- |
| `SPRING_PROFILES_ACTIVE` | Активный Spring-профиль (`dev`, `test`, `prod`) | `dev` в Docker, иначе не задан |
| `APP_DB_URL` | JDBC-URL БД для активного профиля | `jdbc:postgresql://localhost:5432/orm_hibernate_demo` |
| `APP_DB_USERNAME` | Пользователь БД | `postgres` |
| `APP_DB_PASSWORD` | Пароль БД | `postgres` |

## Описание предметной области

Это система для управления образовательным процессом в университете. В ней есть преподаватели, студенты, курсы, уроки и задания.

---

## Люди в системе

### Person (абстрактная сущность)
Базовая сущность для всех людей в системе - студентов и преподавателей. Содержит общую информацию: имя, фамилию, дату рождения.

### Student (Студент)
Студент - это человек, который учится. У каждого студента есть уникальный студенческий номер и статус (активен, отчислен, выпустился и т.д.). Студент может иметь несколько email'ов и телефонов для связи.

**Что студент может делать:**
- Зачисляться на курсы
- Сдавать задания по курсам

### Teacher (Преподаватель)
Преподаватель - это человек, который ведёт курсы. У преподавателя может быть учёное звание (доцент, профессор и т.д.).

**Что преподаватель может делать:**
- Создавать и вести курсы
- Быть автором курса

---

## Образовательный контент

### Course (Курс)
Курс - это учебная дисциплина (например, "Математический анализ" или "Базы данных"). У каждого курса есть автор (преподаватель), название, описание и количество кредитов. Курс можно пометить ключевыми словами и тегами для поиска.

**Что есть в курсе:**
- Уроки (лекции, семинары) - упорядоченные по порядку
- Задания с дедлайнами - отсортированные по сроку сдачи
- Теги для категоризации
- Главный учебный ресурс (видео или статья)

**Кто может быть в курсе:**
- Студенты зачисляются на курс через Enrollment (зачисление)

### Lesson (Урок)
Урок - это одно занятие в рамках курса (например, "Лекция 1: Введение в SQL"). Уроки идут в определённом порядке. У каждого урока есть программа (что будет изучаться) и список учебных материалов (ссылки на видео, статьи и т.д.).

**Связь с курсом:**
- Урок принадлежит одному курсу
- Уроки в курсе идут в строгом порядке (первый урок, второй и т.д.)

### Assignment (Задание)
Задание - это задача, которую студент должен выполнить и сдать до определённого срока (например, "Домашняя работа №3"). У каждого задания есть дедлайн и максимальный балл.

**Связь с курсом:**
- Задание принадлежит одному курсу
- Задания в курсе отсортированы по дате сдачи

**Что студенты делают с заданием:**
- Сдают его (создают Submission)

### Tag (Тег)
Тег - это метка для категоризации курсов (например, "Математика", "Программирование", "Начальный уровень"). Один курс может иметь много тегов, один тег может быть у многих курсов.

**Для чего:**
- Группировка курсов по темам
- Поиск курсов по категориям

---

## Зачисление и обучение

### Enrollment (Зачисление)
Зачисление - это связь между студентом и курсом. Когда студент записывается на курс, создаётся Enrollment. В нём указывается:
- Когда студент зачислился
- В какой роли (обычный студент, слушатель, ассистент преподавателя)
- Текущий статус (учится, завершил, отчислен)
- Итоговая оценка (когда курс завершён)

**Важные правила:**
- Студент может зачислиться на один курс только один раз
- Только активные студенты могут зачисляться на курсы

---

## Сдача заданий и оценки

### Submission (Сдача задания)
Submission - это попытка студента сдать задание. Студент прикрепляет своё решение (ссылку на работу) и отправляет на проверку. У каждой сдачи есть номер попытки (первая попытка, вторая и т.д.) и статус (ожидает проверки, проверено, отклонено).

**Связи:**
- Студент сдаёт задание (Assignment)
- К сдаче прикрепляются файлы (SubmissionAttachment)
- За сдачу выставляется оценка (Grade)

### Grade (Оценка)
Оценка - это результат проверки сдачи задания. Преподаватель выставляет баллы и может оставить комментарий. У каждой сдачи может быть только одна оценка.

**Связь с Submission:**
- Оценка жёстко связана с одной конкретной сдачей (у них общий ID)

### SubmissionAttachment (Вложенный файл)
Это файл, который студент прикрепил к своей сдаче (например, PDF с решением, архив с кодом). У файла есть ссылка, тип и размер.

**Связь:**
- Относится к одной сдаче
- Автоматически удаляется при удалении сдачи (на уровне базы данных)

---

## Учебные ресурсы

### LearningResource (абстрактный учебный ресурс)
Учебный ресурс - это материал для изучения. Может быть видео или статьёй. У каждого ресурса есть название и уровень сложности.

**Где используется:**
- Курс может иметь главный (featured) ресурс
- Урок может иметь основной ресурс
- К заданию можно прикрепить несколько ресурсов для подготовки

### VideoResource (Видео)
Видео-материал с указанием продолжительности и ссылкой на расшифровку.

### ArticleResource (Статья)
Текстовый материал с указанием времени на прочтение.

---

## Как всё связано между собой

### Жизненный цикл обучения:

1. **Преподаватель создаёт курс**
   - Курс → принадлежит Teacher (автор)
   - Курс → содержит упорядоченные Lesson (уроки)
   - Курс → содержит Assignment (задания с дедлайнами)
   - Курс → помечается Tag'ами для поиска

2. **Студент зачисляется на курс**
   - Создаётся Enrollment (зачисление)
   - Enrollment → связывает Student и Course
   - Только ACTIVE студенты могут зачисляться

3. **Студент учится**
   - Студент смотрит Lesson (уроки) в порядке
   - Каждый Lesson → содержит список учебных материалов (ссылки)
   - Lesson → может ссылаться на основной LearningResource (видео или статью)

4. **Студент сдаёт задания**
   - Студент создаёт Submission (сдачу) для Assignment (задания)
   - К Submission → прикрепляет SubmissionAttachment (файлы)
   - Преподаватель создаёт Grade (оценку) для этой Submission

5. **Студент завершает курс**
   - В Enrollment → выставляется финальная оценка
   - Enrollment → меняет статус на COMPLETED (завершён)

### Группировка и поиск:

- **Tag'и группируют курсы по темам**: один Tag → связан со многими Course, один Course → имеет много Tag'ов
- **LearningResource используется в разных местах**: один ресурс → может быть главным для Course, основным для Lesson, и справочным для Assignment

### Удаление и каскады:

- **Курс удаляется → удаляются все его уроки и задания** (они не могут существовать отдельно)
- **Сдача удаляется → удаляются все прикреплённые файлы** (автоматически на уровне БД)
- **Тег нельзя удалить, если он используется в курсах** (защита от потери данных)

---

## Два типа наследования в проекте

### JOINED наследование (Person → Student/Teacher)
Студенты и преподаватели - это два типа людей с общими данными (имя, фамилия) и специфичными данными (студенческий номер у студента, учёное звание у преподавателя). Они хранятся в разных таблицах, которые связаны через JOIN.

### SINGLE_TABLE наследование (LearningResource → Video/Article)
Видео и статьи - это два типа учебных ресурсов. Они хранятся в одной таблице для быстрого доступа, но имеют разные поля (продолжительность у видео, время чтения у статьи).
